#!groovyâ€‹

// git credentials ID can be obtained by clicking on the "Credentials" link within jenkins and using the "ID" for the appropriate ssh key
def GIT_CREDENTIALS_ID = 'github-key'
def GIT_URL = 'git@github.com:davetrux/js-app-configuration.git'
def APP_DIR = 'vue-webpack'
def IMAGE_NAME = 'vue-webpack'

properties(
    [
        buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')),
    ]
)
podTemplate(
  label: "vue-webpack-build",
  containers: [
    containerTemplate(name: 'nodejs', image: "node:12-alpine", ttyEnabled: true, command: 'cat'),
    containerTemplate(name: 'docker', image: 'docker:19', ttyEnabled: true, command: 'cat'),
    // containerTemplate(name: 'helm', image: 'dtzar/helm-kubectl:2.15.0', command: 'cat', ttyEnabled: true)
  ],
  volumes: [
    hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
  ]
)
{
    node(label) {
        stage('git checkout') {
            checkout scm
//             container('nodejs') {
//                 git credentialsId: GIT_CREDENTIALS_ID, url: GIT_URL
//            }
        }
    }
 }
//
//         stage('APP npm install') {
//             container('nodejs') {
//                 dir (APP_DIR) {
//                     sh 'npm install'
//                 }
//             }
//         }
//
//         stage('APP npm build') {
//             container('nodejs') {
//                 dir (APP_DIR) {
//                     sh 'npm run build'
//                 }
//             }
//         }
//         stage('Create Docker Image') {
//             env.NODE_ENV = 'production'
//             container('docker'){
//                 def customImage = docker.build("${IMAGE_NAME}:${env.BUILD_ID}")
//             }
//         }
//     }
// }